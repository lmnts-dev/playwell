!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("googleapis"),require("flat-cache"),require("guess-ga"),require("google-oauth2-node"),require("webpack"),require("memory-fs"),require("webpack-sources"),require("lodash.template"),require("path"),require("fs"));else if("function"==typeof define&&define.amd)define(["googleapis","flat-cache","guess-ga","google-oauth2-node","webpack","memory-fs","webpack-sources","lodash.template","path","fs"],t);else{var r="object"==typeof exports?t(require("googleapis"),require("flat-cache"),require("guess-ga"),require("google-oauth2-node"),require("webpack"),require("memory-fs"),require("webpack-sources"),require("lodash.template"),require("path"),require("fs")):t(e.googleapis,e["flat-cache"],e["guess-ga"],e["google-oauth2-node"],e.webpack,e["memory-fs"],e["webpack-sources"],e["lodash.template"],e.path,e.fs);for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}(global,function(e,t,r,o,n,i,u,c,s,a){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.w={},r(r.s=14)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),n=r(2),i="https://www.googleapis.com/auth/analytics.readonly",u=r(1).load("guess-plugin"),c=function(e){return e};t.getReport=function(e){var t=e.period||{startDate:new Date(Date.now()-31536e6),endDate:new Date},s=e.viewId+"-"+function(e){return e.startDate.getTime()+"-"+e.endDate.getTime()}(t),a=u.getKey(s);if(a)return Promise.resolve(JSON.parse(a));var f=r(0).google;return(e.jwt?Promise.resolve(new f.auth.JWT(e.jwt.client_email,null,e.jwt.private_key,[i],null)):o.auth({clientId:"329457372673-hda3mp2vghisfobn213jpj8ck1uohi2d.apps.googleusercontent.com",clientSecret:"4camaoQPOz9edR-Oz19vg-lN",scope:i}).then(function(e){var t=new f.auth.OAuth2;return t.setCredentials(e),t})).then(function(r){return n.fetch({viewId:e.viewId,auth:r,period:t,routes:e.routes.map(function(e){return e.path}),formatter:e.formatter||c})}).then(function(e){return u.setKey(s,JSON.stringify(e)),u.save(),e})}},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=u},function(e,t){e.exports=c},function(e,t){e.exports=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compressGraph=function(e,t){var r=0,o=0,n=[],i=[],u={},c={},s={chunks:n,routes:i},a=[];return Object.keys(e).forEach(function(s){void 0===c[s]&&(i[o]=s,c[s]=o++),a[c[s]]=[],e[s].forEach(function(e){void 0===c[e.route]&&(i[o]=e.route,c[e.route]=o++),void 0===u[e.chunk]&&(n[r]=e.chunk,u[e.chunk]=r++),a[c[s]].push([parseFloat(e.probability.toFixed(t)),c[e.route],u[e.chunk]])})}),{graph:a,graphMap:s}}},function(e,t){e.exports=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(11),n=r(10),i=r(9),u=r(8),c=r(7).ConcatSource,s=function(){function e(e){if(this._config=e,!e.data)throw new Error("Page graph not provided")}return e.prototype.execute=function(e,t){var s={},h=null;if(e.chunks.forEach(function(e){p(e)&&(h=e),l(e,function(e){var t=e.block,r=e.chunk,o=(r.files||[]).filter(function(e){return e.endsWith(".js")}).pop();!o&&r.chunks&&r.chunks[0]&&(o=r.chunks[0].files[0]),s[t.dependencies[0].module.userRequest]=o})}),!h)throw t(),new Error("Cannot find the main chunk of the application");var d={},g=f(this._config.routes,this._config.data);Object.keys(g).forEach(function(e){d[e]=[],g[e].forEach(function(t){var r={probability:t.probability,route:t.route,chunk:s[t.file]};d[e].push(r)})});var v=h.files.filter(function(e){return e.endsWith(".js")}).pop(),y=e.assets[v],m=n.compressGraph(d,3),b=m.graph,w=m.graphMap,_=this._config.delegate?"guess.tpl":"runtime.tpl",P=o.readFileSync(i.join(__dirname,_)).toString(),j=u(P)({BASE_PATH:this._config.basePath,GRAPH:JSON.stringify(b),GRAPH_MAP:JSON.stringify(w),THRESHOLDS:JSON.stringify(Object.assign({},a,this._config.prefetchConfig))}),k=new(r(6));k.mkdirpSync("/src"),k.writeFileSync("/src/index.js",j,"utf-8"),k.writeFileSync("/src/guess.js",o.readFileSync(i.join(__dirname,"guess.js")).toString(),"utf-8"),k.writeFileSync("/src/runtime.js",o.readFileSync(i.join(__dirname,"runtime.js")).toString(),"utf-8");var x=r(5)({context:"/src/",mode:"production",entry:"./index.js",target:"node",output:{filename:"./output.js"}});x.inputFileSystem=k,x.outputFileSystem=k,x.resolvers.normal.fileSystem=k,x.resolvers.context.fileSystem=k,x.run(function(r,o){if(r)throw t(),r;var n=o.compilation.assets["./output.js"].source();e.assets[v]=new c(n,"\n;",y.source()),t()})},e}();t.PrefetchPlugin=s;var a={"4g":.15,"3g":.3,"2g":.45,"slow-2g":.6},f=function(e,t){var r={},o={};return e.forEach(function(e){o[e.path]=e.modulePath}),Object.keys(t).forEach(function(e){r[e]=[];var n=Object.keys(t[e]).reduce(function(r,o){return r+t[e][o]},0);Object.keys(t[e]).forEach(function(i){r[e].push({route:i,probability:t[e][i]/n,file:o[i]})}),r[e]=r[e].sort(function(e,t){return t.probability-e.probability})}),r},p=function(e){return e.canBeInitial?e.canBeInitial():/^main(\.js)?$/.test(e.name)},l=function(e,t){var r=[];(r=e.groupsIterable?Array.from(e.groupsIterable).reduce(function(e,t){return e.concat(r.concat(t.getBlocks().map(function(e){return{chunk:t,block:e}})))},[]):(e.blocks||[]).map(function(t){return{chunk:e,block:t}})).forEach(t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(12),n=r(4),i=function(){function e(e){if(this._config=e,(this._config.GA||this._config.jwt)&&this._config.reportProvider)throw new Error("Only a single report provider is allowed. You have specified `GA` and/or a GA authentication provider (used by Google Analytics provider) and `reportProvider`");if(!this._config.GA&&!this._config.reportProvider)throw new Error("Report provider not specified. You should specify either a `GA` (Google Analytics view ID) or `reportProvider`.")}return e.prototype.apply=function(e){var t=this;e.plugin("emit",function(e,r){return t._execute(e,r)})},e.prototype._execute=function(e,t){var r=this;u(this._config).then(function(o){return r._getReport(o).then(function(n){return r._executePrefetchPlugin(n,o,e,t)},function(e){throw console.error(e),t(),e})})},e.prototype._getReport=function(e){return this._config.GA?n.getReport({jwt:this._config.jwt,viewId:this._config.GA,routes:e,formatter:this._config.routeFormatter,period:this._config.period}):this._config.reportProvider()},e.prototype._executePrefetchPlugin=function(e,t,r,n){var i=this._config.runtime;new o.PrefetchPlugin({data:e,basePath:i?void 0===i.basePath?"":i.basePath:"",prefetchConfig:i?i.prefetchConfig:void 0,routes:t,delegate:!i||!!i.delegate}).execute(r,n)},e}();t.GuessPlugin=i;var u=function(e){if(!1===e.routeProvider||void 0===e.routeProvider)return Promise.resolve([]);if("function"==typeof e.routeProvider)return Promise.resolve(e.routeProvider());throw new Error("The routeProvider should be either set to false or a function which returns the routes in the app.")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(13))}])});